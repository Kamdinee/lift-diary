generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  routines      Routine[]
  workouts      Workout[]
  refreshTokens RefreshToken[]
}

model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())
  revoked   Boolean  @default(false)
}

model Exercise {
  id           String   @id // ID from ExerciseDB or generated
  name         String
  target       String? // muscle group
  bodyPart     String?
  equipment    String?
  gifUrl       String?
  apiSource    String   @default("exercisedb") // 'exercisedb' or 'custom'
  lastSyncedAt DateTime @default(now())

  routineExercises RoutineExercise[]
  workoutSets      WorkoutSet[]
}

model Routine {
  id        String   @id @default(uuid())
  name      String
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  exercises RoutineExercise[]
  workouts  Workout[]
}

model RoutineExercise {
  id            String   @id @default(uuid())
  routineId     String
  routine       Routine  @relation(fields: [routineId], references: [id], onDelete: Cascade)
  exerciseId    String
  exercise      Exercise @relation(fields: [exerciseId], references: [id])
  order         Int      @default(0)
  defaultSeries Int      @default(3)
  defaultReps   Int      @default(10)
  defaultWeight Float? // Optional default weight
}

model Workout {
  id        String    @id @default(uuid())
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  routineId String?
  routine   Routine?  @relation(fields: [routineId], references: [id])
  name      String? // Optional name if not from routine
  startedAt DateTime  @default(now())
  endedAt   DateTime?
  duration  Int? // In seconds

  sets WorkoutSet[]
}

model WorkoutSet {
  id          String   @id @default(uuid())
  workoutId   String
  workout     Workout  @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  exerciseId  String
  exercise    Exercise @relation(fields: [exerciseId], references: [id])
  seriesIndex Int
  reps        Int
  weight      Float
  completed   Boolean  @default(true)
  createdAt   DateTime @default(now())
}
